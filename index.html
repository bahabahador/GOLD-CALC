<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GOLD CALC</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0d0d0d" />

  <style>
    body{
      margin:0; font-family:sans-serif;
      background:linear-gradient(135deg,#0d0d0d,#1c1c1c);
      color:#f5f5f5; padding:20px;
    }
    h1{text-align:center;color:#d4af37}
    .card{max-width:430px;margin:auto;background:#111;padding:20px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.6)}
    label{font-size:13px;color:#ccc;margin-top:12px;display:block}
    input,select{width:100%;padding:12px;border-radius:10px;border:none;background:#1e1e1e;color:#fff;margin-top:6px}
    button{width:100%;margin-top:18px;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#d4af37,#f5d76e);font-weight:bold;font-size:16px}
    .result{margin-top:15px;text-align:center;font-size:18px;color:#d4af37}
    .small{text-align:center;font-size:12px;color:#777;margin-top:20px}
    .history{margin-top:20px;font-size:13px}
    .history div{border-bottom:1px solid #222;padding:6px 0}
    .lock{max-width:300px;margin:80px auto;text-align:center}
  </style>
</head>
<body>

<div id="lock" class="lock">
  <h1>ğŸ”’ GOLD CALC</h1>
  <input type="password" id="pin" placeholder="Enter PIN" />
  <button onclick="unlock()">ÙˆØ±ÙˆØ¯</button>
</div>

<div id="app" style="display:none">
  <h1>ğŸ’ GOLD CALC</h1>
  <div class="card">
    <label>Mode</label>
    <select id="mode">
      <option value="sell">Ø®Ø±ÛŒØ¯ Ø§Ø² Ù…Ø´ØªØ±ÛŒ (735)</option>
      <option value="exchange">ØªØ¹ÙˆÛŒØ¶ (740)</option>
      <option value="new">ÙØ±ÙˆØ´ Ø·Ù„Ø§ÛŒ Ù†Ùˆ</option>
      <option value="quick">âš¡ Quick</option>
    </select>

    <label>Gold Price (Toman)</label>
    <input type="number" id="price" />

    <label>Weight (gram)</label>
    <input type="number" id="weight" />

    <label>Ojrat %</label>
    <input type="number" id="ojrat" value="15" />

    <label>Profit %</label>
    <input type="number" id="profit" value="7" />

    <label>Tax %</label>
    <input type="number" id="tax" value="10" />

    <button onclick="calc()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
    <div class="result" id="result">â€”</div>
    <div class="result" id="diff"></div>

    <button onclick="exportCSV()">ğŸ“¤ Export History</button>

    <div class="history" id="history"></div>
  </div>
  <div class="small">ØªÙˆØ³Ø· Ø¨Ù‡Ø§Ø¯Ø± Ù…Ø­Ù…Ø¯Ø²Ø§Ø¯Ù‡</div>
</div>

<script>
// LOCK
let savedPin = localStorage.getItem('goldPin') || '1234';
function unlock(){
  const p = document.getElementById('pin').value;
  if(p===savedPin){
    document.getElementById('lock').style.display='none';
    document.getElementById('app').style.display='block';
  } else alert('Wrong PIN');
}

// HISTORY
let history = JSON.parse(localStorage.getItem('goldHistory')||'[]');
render();

function calc(){
  const m=document.getElementById('mode').value;
  const price=+priceEl.value, w=+weightEl.value;
  const oj=+ojrat.value/100, pr=+profit.value/100, tx=+tax.value/100;
  let res=0, diff='';

  if(m==='sell') res=price*w*0.735;
  if(m==='exchange'){
    const buy=price*w*0.735;
    const ex=price*w*0.74;
    res=ex; diff=`Ù…Ø§Ø¨Ù‡â€ŒØ§Ù„ØªÙØ§ÙˆØª: ${(ex-buy).toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
  }
  if(m==='new'){
    const base=price*w;
    const o=base*oj;
    const p=(base+o)*pr;
    const t=(o+p)*tx;
    res=base+o+p+t;
  }
  if(m==='quick') res=price*w;

  result.innerText=res.toLocaleString()+' ØªÙˆÙ…Ø§Ù†';
  diffEl.innerText=diff;

  history.unshift({m,res,date:new Date().toLocaleString()});
  history=history.slice(0,20);
  localStorage.setItem('goldHistory',JSON.stringify(history));
  render();
}

function render(){
  historyEl.innerHTML='<b>ğŸ“œ History</b>'+
    history.map(h=>`<div>${h.date}<br>${h.res.toLocaleString()} ØªÙˆÙ…Ø§Ù†</div>`).join('');
}

function exportCSV(){
  let csv='Date,Amount\n';
  history.forEach(h=>csv+=`${h.date},${h.res}\n`);
  const blob=new Blob([csv]);
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='gold-history.csv';
  a.click();
}

if('serviceWorker'in navigator){navigator.serviceWorker.register('sw.js');}
</script>
</body>
</html>
